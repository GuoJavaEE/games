import{p as t,e as o,o as i,c as s,f as e,w as c}from"./vendor.eda28678.js";const n=(t,o,i=100)=>{t&&setTimeout((()=>{t(o)}),i)};const A={iconBlockEnd:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN0QAADdEBwivf4wAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAGrSURBVFiF7ZlPTsJAFId/700TrYUWXZhSVAw7PQSykMAVPAtrD+ApuIJEF8oBXLo0Ev/EmMifItRIOs+FyILEuGhCx6RfMvsv75vZvCERAQDU6k1fa30KoMpEZRAIq0QgWqQHoMvMrauL8xcAIBFBrd5siNbt4aA/Go8G4UcURSuVm7Nu23be23QLm1seMZ9cXZx36Oi44YvWtw/3d0/RdDJJQ2wZe8NxdvcrJWI+VHv7lbNh/y0Y9t8GaYv9MJt9zpRlWWvrdoUBVMPhIExbapm5U9VionI0ndykLbRMNJ1ETHRgYf5QDIU4bYO/sADA4AmaL5glToolMFdQkCVOjvGCWeKkGC+YJU5KNsGkGC+YJU6K8YJZ4qQYL5glTorxgv8isQDmTZGIAEAsrePehpOz38dhKlvV33ByeVvruMcAdbf9opu20DLfTtRlpVSrGJQ81ys4IgITjusVnGJQ8pRSLRIRHB03GqJ1+/npcfT68hy+j8fRqu8kESGXz9vbfuAGpR2PmE+uLzudxfKyVm/6cRyfQqTKSpWBFX9DAKLjuAeirlJq8Q3xBZXrMZo1QiYvAAAAAElFTkSuQmCC",iconBlockFront:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN0QAADdEBwivf4wAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHBSURBVFiF7Zk/ThtREId/894j+5fdRXaAiMJNFCkcwiEIYjgCZ3Hts3AE/kkB+QApXURpXERJHFuyF6/XJtoZKiynSLWS/SLtd4JP32iaGRIRAMDR6dm+1roDoMnMDQCE9SJKqT6AblEU7Ye7658AQCKCj5/OW0R0+Wbv9WS3XksD38+J1usnIshmM28wHEU/fv2OReTi/vbqhj6ctPaVUr3Dd2+/R9thtlarf5A+ToPe128HzHxotFKd3XptEgZ+xsybdgMAhIGf7dVrk8Fw1DEAmjtJnBZFsWmvv9hJ4nQwHDUNizRc1/liS70XXNfJWeS9gQixZfWWiJARALaN9wUBYADAtvGuYgB7CwJVwfJUBctSFSzL/yFYjbgEVcGyVAXLQbYX1JYX1JYLkrZ8STQsX5KloK0FAcsLAlXB8lQFy2IAiMWCYoS5r82W9+dpkW/aZpWtV44nzH0DoOv6wfE8n1kluO0HEYDPhpRqh1Hcy6bpdJHnVpyAHc8LwiiOiahNIoKj07OWCF+m4/Fkmo7TxXy+kZqO63phlERRksRE6uLh7vqGVt8QzNwB0FSKGsCaz/wQYZY+gK5SavmGeAaV/fpQD4SQKgAAAABJRU5ErkJggg==",iconBomb:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAeCAYAAADD0FVVAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAFhgAABYYBG6Yz4AAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAGUSURBVEiJrZW7SgNREIa/PYhBsQmCiIWFRWzFWFqI4CvoEyio2AqWFla+QN7Axjew8NKK9oqmsjIGjBESjeS3yByve8lu9octlvnnY3Z2zpxAEhk1CuwCp8D5z4DLCFwHHoDtUIaktM+BpHdJTUlTYZ60wD1JHfW0FuVLAyxKahvwOM6bpqcbQBd4AjZjnSkqrVqVq0neIGGkalYdwATwDjwDI8ACcBuWNJTwyR/A5I/3YYPXiBnHqEAB2AfGI+JFYMd8/xXSk7L1z//pKL2Zr5w0UoeS6gmwv6pbXih0S71TkkVNy/8FnZZUywj0qhnnC3opqTsgtGscHLAIzABBzGj1o8A4ix5aHBDoVfTQZQav0isAlh1QygnoVXJEnYrsKjigkTO04YDrnKHXDjgBOjkBO8CJAy6Al5ygL8CFA+6BI6A9ILBtnHt/TIf1fV1kVdU4v7bUvNKvPa+65Yfu0zlJd5JafcJa5p9TzJJGUkFSRdKjets9TG8Wr5i/79t0FlgCVoAyMAa8Alf0xvAMuAlL/AQOkeuIsYF05QAAAABJRU5ErkJggg==",iconFlag:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAeCAYAAAAy2w7YAAAAoklEQVRIie3WwQ2AIAwFUGpczMmMkzna9wIKpECR2oOhJwPKowgNBMBJg4iSlwGQ9Nv1LeIbn7YGukghwUzguMn4EGfUBYaIstTLqIR6+FsoAm0gZ5WRGQSQ/q7LgPD4DcQcXv2lK1QIvYwaJWgcEhbWsaXrqN4/O0cTmtCEVKJZ646tfIWK+/azXo6Iu6nWBpcEhybQKFAD73+kjeRjmm2GCx6wOIUIqsGWAAAAAElFTkSuQmCC"},a=(t,o)=>Array(t).fill(o),l=(t,o,i)=>t.find((t=>t.row===o&&t.col===i)),h=(t,o,i)=>{const s=a(t,0).reduce(((t,i,s)=>t.concat(a(o,0).map(((t,o)=>({row:s,col:o,num:0}))))),[]),e=a(i,9).concat(a(s.length-i,0));return e.sort((()=>Math.random()-.5)),s.forEach(((t,o)=>{t.num=e[o]})),(t=>{const o=(o,i)=>l(t,o,i);t.forEach((t=>{9!==t.num&&(t.num=[o(t.row-1,t.col-1),o(t.row-1,t.col),o(t.row-1,t.col+1),o(t.row,t.col+1),o(t.row+1,t.col+1),o(t.row+1,t.col),o(t.row+1,t.col-1),o(t.row,t.col-1)].filter((t=>t&&9===t.num)).length)}))})(s),s};class r{constructor(t,o={}){this.cvs=t,this.callbacks=o,this.blockSize=0,this.rows=9,this.cols=9,this.mineCount=10,this.blockSpace=6,this.isGameover=!1,this.isFirstClick=!0,this.isSourceLoaded=!1,this.blocks=[],this.icons={},this.ctx=t.getContext("2d"),this.pixRatio=(t=>{const o=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||1;return(window.devicePixelRatio||1)/o})(this.ctx)}addListeners(){this.cvs.addEventListener("click",this.onClick.bind(this)),this.cvs.addEventListener("contextmenu",this.onContextmenu.bind(this)),window.addEventListener("resize",this.onResize.bind(this))}removeListeners(){this.cvs.removeEventListener("click",this.onClick),this.cvs.removeEventListener("contextmenu",this.onContextmenu),window.removeEventListener("resize",this.onResize)}onResize(){this.updateSize(),this.drawUI()}start(t,o,i){t&&(this.rows=t),o&&(this.mineCount=o),i&&(this.blockSpace=i),this.isGameover=!1,this.isFirstClick=!0,this.blocks=h(this.rows,this.cols,this.mineCount),this.updateSize(),this.isSourceLoaded?this.drawUI():Promise.all(Object.keys(A).map((t=>{return(o=A[t],new Promise(((t,i)=>{const s=new Image;s.onload=()=>{t(s)},s.onerror=i,s.src=o}))).then((o=>{this.icons[t]=o}));var o}))).then((()=>{this.isSourceLoaded=!0,this.drawUI(),this.addListeners()})).catch((t=>{alert(t.message)})),n(this.callbacks.onUpdate,this.getStateData(),0)}updateSize(){var t;const{blockSpace:o}=this,i=this.cvs.offsetWidth*this.pixRatio,s=(i-o)/this.cols-o,e=(null==(t=this.cvs.parentElement)?void 0:t.offsetHeight)*this.pixRatio;this.rows*(s+o)+o>e&&(this.rows=Math.floor(e/(s+o))),this.blockSize=s,this.cvs.width=i,this.cvs.height=this.rows*(s+o)+o}drawBlockBackground(t,o){const{blockSize:i,blockSpace:s}=this;this.ctx.drawImage(o,0,0,o.width,o.height,t.col*i+(t.col+1)*s,t.row*i+(t.row+1)*s,i,i)}drawBlockText(t){const o=t.num+"",{blockSize:i,blockSpace:s,ctx:e}=this,c=i/2+"px",n={1:"#ff0",2:"#0f0"}[o]||"#f00",A=e.measureText(o).width,a=t.col*(i+s)+s+(i-A)/2+this.pixRatio,l=t.row*(i+s)+s+(i-A)/2;e.save(),e.font=`bold ${c} serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=n,e.fillText(o,a,l),e.restore()}drawBlockIcon(t,o){const{blockSize:i,blockSpace:s}=this;let e,c;o.width>o.height?(e=i/2,c=e*(o.height/o.width)):(c=i/2,e=c*(o.width/o.height)),this.ctx.drawImage(o,t.col*(i+s)+s+(i-e)/2,t.row*(i+s)+s+(i-c)/2,e,c)}drawUI(){const{width:t,height:o}=this.cvs;this.ctx.clearRect(0,0,t,o),this.blocks.forEach((t=>{t.open?(this.drawBlockBackground(t,this.icons.iconBlockEnd),t.num>0&&(t.num<9?this.drawBlockText(t):this.drawBlockIcon(t,this.icons.iconBomb))):(this.drawBlockBackground(t,this.icons.iconBlockFront),t.flag&&this.drawBlockIcon(t,this.icons.iconFlag))}))}getCurBlock(t){const o=(t.offsetX||t.pageX)*this.pixRatio,i=(t.offsetY||t.pageY)*this.pixRatio,s=Math.floor(o/(this.blockSize+this.blockSpace)),e=Math.floor(i/(this.blockSize+this.blockSpace));return this.blocks.find((t=>t.row===e&&t.col===s))}swapBlockNum(t){const o=this.blocks.filter((t=>t.num<9));var i,s;const e=o[(i=0,s=o.length-1,Math.floor(Math.random()*(s-i+1)+i))],{num:c}=e;e.num=t.num,t.num=c}bombAndOver(){this.blocks.forEach((t=>{9===t.num&&(t.open=!0)})),this.isGameover=!0}openZeroBlocks(t){const o=(t,o)=>l(this.blocks,t,o);[o(t.row-1,t.col),o(t.row,t.col+1),o(t.row+1,t.col),o(t.row,t.col-1)].filter((t=>t)).forEach((t=>{(null==t?void 0:t.open)||(null==t?void 0:t.flag)||0!==(null==t?void 0:t.num)||(t.open=!0,this.openZeroBlocks(t))}))}isDone(){return this.blocks.filter((t=>t.num<9)).every((t=>t.open))}getStateData(){return this.blocks.reduce(((t,o)=>({opens:t.opens+(o.open?1:0),flags:t.flags+(o.flag?1:0)})),{opens:0,flags:0})}onClick(t){if(this.isGameover)return;const o=this.getCurBlock(t);!o||o.open||o.flag||(this.isFirstClick&&(this.isFirstClick=!1,9===o.num&&this.swapBlockNum(o)),o.open=!0,9===o.num?(this.bombAndOver(),n(this.callbacks.onOver)):0===o.num&&this.openZeroBlocks(o),n(this.callbacks.onUpdate,this.getStateData(),0),this.drawUI(),this.isDone()&&(this.isGameover=!0,n(this.callbacks.onWinning)))}onContextmenu(t){if(t.preventDefault(),this.isGameover)return;const o=this.getCurBlock(t);o&&!o.open&&(o.flag=!o.flag,this.drawUI(),n(this.callbacks.onUpdate,this.getStateData(),0))}}var d={mounted(){const t=new r(this.$refs.ui,{onUpdate:t=>{console.log(t)},onOver:()=>{alert("很遗憾，挑战失败！"),t.start()},onWinning:()=>{alert("恭喜你！挑战成功"),t.start(t.cols+2,t.mineCount+2)}});t.start()}};const k=c();t("data-v-6565c27e");const w={class:"container"},m=e("div",{class:"dashboard"},[e("div",{class:"title"},"扫雷游戏")],-1),g={class:"game-ui"},u={ref:"ui"};o();const v=k(((t,o,c,n,A,a)=>(i(),s("div",w,[m,e("div",g,[e("canvas",u,null,512)])]))));d.render=v,d.__scopeId="data-v-6565c27e";export default d;
