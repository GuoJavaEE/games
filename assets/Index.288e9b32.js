import{g as t,a as s,c as i,d as e}from"./utils.3a965408.js";import{p as o,e as a,o as c,c as n,f as h,w as r}from"./vendor.eda28678.js";var l="_keyboard_12nx8_1",d="_visible_12nx8_12";class b{constructor(t,s,i,e=0){this.row=t,this.col=s,this.isInput=i,this.num=e}draw(t,s,i){const e=(s+i)*this.col+i,o=(s+i)*this.row+i;if(t.save(),this.isInput&&(t.fillStyle="#fff",t.fillRect(e,o,s,s)),this.num){const i=this.num+"";t.fillStyle="#424242",t.font=`bold ${s/2}px serif`,t.textBaseline="hanging",t.textAlign="left";const a=t.measureText(i).width;t.fillText(i,e+(s-a)/2,o+(s-a)/2)}t.restore()}}class u{constructor(s,i){this.cvs=s,this.callbacks=i,this.emptyCount=20,this.rows=9,this.cols=9,this.colors=["#ccc","#def1e6"],this.blocks=[],this.bakEmptyBlocks=[],this.bSize=0,this.ctx=s.getContext("2d"),this.pixRatio=t(this.ctx),this.bSpace=this.pixRatio,this.keyboard=this.createKeyboard(),this.addListeners()}start(t){t&&(this.emptyCount=Math.min(t,60)),this.updateSize();const{blocks:s,bakEmptyBlocks:i}=this.genBlocks();this.blocks=s,this.bakEmptyBlocks=i,this.drawUI()}updateSize(){const t=this.cvs.offsetWidth*this.pixRatio;this.bSize=(t-(this.cols+1)*this.bSpace)/this.cols,this.cvs.width=this.cvs.height=t}drawUI(){const{ctx:t,cvs:s}=this;t.clearRect(0,0,s.width,s.height),this.drawBG(),this.drawGrid(),this.blocks.forEach((s=>{s.draw(t,this.bSize,this.bSpace)}));const{focusBlock:i}=this;if(i){const s=(this.bSize+this.bSpace)*i.col+this.bSpace,e=(this.bSize+this.bSpace)*i.row+this.bSpace;t.save(),t.strokeStyle=t.shadowColor="#00f",t.shadowBlur=8*this.bSpace,t.strokeRect(s,e,this.bSize,this.bSize),t.restore()}}drawBG(){const{ctx:t}=this,i=this.cvs.width/3;let e=0;t.save(),s(3).forEach(((o,a)=>{s(3).forEach(((s,o)=>{t.fillStyle=this.colors[e++%2],t.fillRect(o*i,a*i,i,i)}))})),t.restore()}drawGrid(){const{ctx:t,bSpace:i}=this,{width:e}=this.cvs;t.save(),t.lineWidth=i,t.strokeStyle="#424242",t.beginPath(),s(this.rows+1).forEach(((s,o)=>{const a=o*(this.bSize+i)+i/2;t.moveTo(0,a),t.lineTo(e,a),t.moveTo(a,0),t.lineTo(a,e)})),t.stroke(),t.restore()}genBlocks(){const t=[[8,7,1,9,3,2,6,4,5],[4,9,5,8,6,1,2,3,7],[6,3,2,7,5,4,8,1,9],[5,2,8,4,7,3,1,9,6],[9,1,3,6,2,5,7,8,4],[7,6,4,1,9,8,3,5,2],[2,8,7,3,4,9,5,6,1],[1,4,6,5,8,7,9,2,3],[3,5,9,2,1,6,4,7,8]];s(50).forEach((s=>{const e=i(1,this.cols),o=i(1,this.cols);e!==o&&t.forEach(((s,i)=>{s.forEach(((s,a)=>{s===e?t[i][a]=o:s===o&&(t[i][a]=e)}))}))}));const e=t.reduce(((t,s,i)=>[...t,...s.map(((t,s)=>new b(i,s,!1,t)))]),[]).sort((()=>Math.random()-.5)),o=e.slice(0,this.emptyCount),a=JSON.parse(JSON.stringify(o));return o.forEach((t=>{t.num=0,t.isInput=!0})),{bakEmptyBlocks:a,blocks:e}}getCurBlock(t){const{bSize:s,bSpace:i,pixRatio:e}=this,o=(t.offsetX||t.pageX)*e,a=(t.offsetY||t.pageY)*e;return this.blocks.find((t=>{const e=(s+i)*t.col+i,c=(s+i)*t.row+i;return o>e&&o<e+s&&a>c&&a<c+s}))}createKeyboard(){var t;const i=document.createElement("ul");return i.className=l,i.innerHTML=s(9).map(((t,s)=>`<li>${s+1}</li>`)).join(""),null==(t=this.cvs.parentElement)||t.appendChild(i),i}updateKeyboardPosition(){const{bSize:t,bSpace:s,keyboard:i,focusBlock:e}=this;if(e){const{row:o}=e;i.style.top=((o+1)*(t+s)+s)/this.pixRatio+"px",i.classList.add(d)}else i.classList.remove(d)}isDone(){return this.bakEmptyBlocks.every(((t,s)=>t.num===this.blocks[s].num))}addListeners(){this.cvs.addEventListener("click",this.onClick.bind(this)),this.keyboard.addEventListener("click",this.onKeyboardClick.bind(this)),window.addEventListener("resize",this.onResize.bind(this))}removeListeners(){this.cvs.removeEventListener("click",this.onClick),this.keyboard.removeEventListener("click",this.onKeyboardClick),window.removeEventListener("resize",this.onResize)}onClick(t){const s=this.getCurBlock(t);this.focusBlock=s&&s.isInput?s:void 0,this.drawUI(),this.updateKeyboardPosition()}onKeyboardClick(t){const{target:s}=t,{focusBlock:i}=this;s&&"li"===s.tagName.toLowerCase()&&(i&&(i.num=+s.textContent,this.focusBlock=void 0,this.drawUI(),this.isDone()&&e(this.callbacks.onDone)),this.keyboard.classList.remove(d))}onResize(){this.updateSize(),this.drawUI(),this.updateKeyboardPosition()}}var m={data:()=>({game:null}),mounted(){this.game=new u(this.$refs.canvas,{onDone:()=>{var t;alert("恭喜你！挑战成功！"),null==(t=this.game)||t.start(this.game.emptyCount+4)}}),this.game.start()},unmounted(){var t;null==(t=this.game)||t.removeListeners(),this.game=null},methods:{onStart(){var t;null==(t=this.game)||t.start()}}};const p=r();o("data-v-76afdab9");const v={class:"container"},k={class:"dashboard"},f=h("div",{class:"title"},"数独",-1),S={class:"btns"},w={class:"game-ui"},y={ref:"canvas"};a();const g=p(((t,s,i,e,o,a)=>(c(),n("div",v,[h("div",k,[f,h("div",S,[h("button",{onClick:s[1]||(s[1]=(...t)=>a.onStart&&a.onStart(...t))},"新游戏")])]),h("div",w,[h("canvas",y,null,512)])]))));m.render=g,m.__scopeId="data-v-76afdab9";export default m;
