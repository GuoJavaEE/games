import{g as t,i as s,d as i,c as o,b as e}from"./utils.44e4807a.js";import{p as A,e as c,o as n,c as a,f as l,w as h}from"./vendor.eda28678.js";const r={iconBlockEnd:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN0QAADdEBwivf4wAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAGrSURBVFiF7ZlPTsJAFId/700TrYUWXZhSVAw7PQSykMAVPAtrD+ApuIJEF8oBXLo0Ev/EmMifItRIOs+FyILEuGhCx6RfMvsv75vZvCERAQDU6k1fa30KoMpEZRAIq0QgWqQHoMvMrauL8xcAIBFBrd5siNbt4aA/Go8G4UcURSuVm7Nu23be23QLm1seMZ9cXZx36Oi44YvWtw/3d0/RdDJJQ2wZe8NxdvcrJWI+VHv7lbNh/y0Y9t8GaYv9MJt9zpRlWWvrdoUBVMPhIExbapm5U9VionI0ndykLbRMNJ1ETHRgYf5QDIU4bYO/sADA4AmaL5glToolMFdQkCVOjvGCWeKkGC+YJU5KNsGkGC+YJU6K8YJZ4qQYL5glTorxgv8isQDmTZGIAEAsrePehpOz38dhKlvV33ByeVvruMcAdbf9opu20DLfTtRlpVSrGJQ81ys4IgITjusVnGJQ8pRSLRIRHB03GqJ1+/npcfT68hy+j8fRqu8kESGXz9vbfuAGpR2PmE+uLzudxfKyVm/6cRyfQqTKSpWBFX9DAKLjuAeirlJq8Q3xBZXrMZo1QiYvAAAAAElFTkSuQmCC",iconBlockFront:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN0QAADdEBwivf4wAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHBSURBVFiF7Zk/ThtREId/894j+5fdRXaAiMJNFCkcwiEIYjgCZ3Hts3AE/kkB+QApXURpXERJHFuyF6/XJtoZKiynSLWS/SLtd4JP32iaGRIRAMDR6dm+1roDoMnMDQCE9SJKqT6AblEU7Ye7658AQCKCj5/OW0R0+Wbv9WS3XksD38+J1usnIshmM28wHEU/fv2OReTi/vbqhj6ctPaVUr3Dd2+/R9thtlarf5A+ToPe128HzHxotFKd3XptEgZ+xsybdgMAhIGf7dVrk8Fw1DEAmjtJnBZFsWmvv9hJ4nQwHDUNizRc1/liS70XXNfJWeS9gQixZfWWiJARALaN9wUBYADAtvGuYgB7CwJVwfJUBctSFSzL/yFYjbgEVcGyVAXLQbYX1JYX1JYLkrZ8STQsX5KloK0FAcsLAlXB8lQFy2IAiMWCYoS5r82W9+dpkW/aZpWtV44nzH0DoOv6wfE8n1kluO0HEYDPhpRqh1Hcy6bpdJHnVpyAHc8LwiiOiahNIoKj07OWCF+m4/Fkmo7TxXy+kZqO63phlERRksRE6uLh7vqGVt8QzNwB0FSKGsCaz/wQYZY+gK5SavmGeAaV/fpQD4SQKgAAAABJRU5ErkJggg==",iconBomb:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAeCAYAAADD0FVVAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAFhgAABYYBG6Yz4AAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAGUSURBVEiJrZW7SgNREIa/PYhBsQmCiIWFRWzFWFqI4CvoEyio2AqWFla+QN7Axjew8NKK9oqmsjIGjBESjeS3yByve8lu9octlvnnY3Z2zpxAEhk1CuwCp8D5z4DLCFwHHoDtUIaktM+BpHdJTUlTYZ60wD1JHfW0FuVLAyxKahvwOM6bpqcbQBd4AjZjnSkqrVqVq0neIGGkalYdwATwDjwDI8ACcBuWNJTwyR/A5I/3YYPXiBnHqEAB2AfGI+JFYMd8/xXSk7L1z//pKL2Zr5w0UoeS6gmwv6pbXih0S71TkkVNy/8FnZZUywj0qhnnC3opqTsgtGscHLAIzABBzGj1o8A4ix5aHBDoVfTQZQav0isAlh1QygnoVXJEnYrsKjigkTO04YDrnKHXDjgBOjkBO8CJAy6Al5ygL8CFA+6BI6A9ILBtnHt/TIf1fV1kVdU4v7bUvNKvPa+65Yfu0zlJd5JafcJa5p9TzJJGUkFSRdKjets9TG8Wr5i/79t0FlgCVoAyMAa8Alf0xvAMuAlL/AQOkeuIsYF05QAAAABJRU5ErkJggg==",iconFlag:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAeCAYAAAAy2w7YAAAAoklEQVRIie3WwQ2AIAwFUGpczMmMkzna9wIKpECR2oOhJwPKowgNBMBJg4iSlwGQ9Nv1LeIbn7YGukghwUzguMn4EGfUBYaIstTLqIR6+FsoAm0gZ5WRGQSQ/q7LgPD4DcQcXv2lK1QIvYwaJWgcEhbWsaXrqN4/O0cTmtCEVKJZ646tfIWK+/azXo6Iu6nWBpcEhybQKFAD73+kjeRjmm2GCx6wOIUIqsGWAAAAAElFTkSuQmCC"},d=(t,s,i)=>t.find((t=>t.row===s&&t.col===i)),m=(t,s,i)=>{const o=e(t,0).reduce(((t,i,o)=>t.concat(e(s,0).map(((t,s)=>({row:o,col:s,num:0}))))),[]),A=e(i,9).concat(e(o.length-i,0));return A.sort((()=>Math.random()-.5)),o.forEach(((t,s)=>{t.num=A[s]})),(t=>{const s=(s,i)=>d(t,s,i);t.forEach((t=>{9!==t.num&&(t.num=[s(t.row-1,t.col-1),s(t.row-1,t.col),s(t.row-1,t.col+1),s(t.row,t.col+1),s(t.row+1,t.col+1),s(t.row+1,t.col),s(t.row+1,t.col-1),s(t.row,t.col-1)].filter((t=>t&&9===t.num)).length)}))})(o),o};class g{constructor(s,i={}){this.cvs=s,this.callbacks=i,this.blockSize=0,this.rows=9,this.cols=9,this.mineCount=10,this.blockSpace=6,this.isGameover=!1,this.isFirstClick=!0,this.isSourceLoaded=!1,this.blocks=[],this.icons={},this.ctx=s.getContext("2d"),this.pixRatio=t(this.ctx)}addListeners(){this.cvs.addEventListener("click",this.onClick.bind(this)),this.cvs.addEventListener("contextmenu",this.onContextmenu.bind(this)),window.addEventListener("resize",this.onResize.bind(this))}removeListeners(){this.cvs.removeEventListener("click",this.onClick),this.cvs.removeEventListener("contextmenu",this.onContextmenu),window.removeEventListener("resize",this.onResize)}onResize(){this.updateSize(),this.drawUI()}start(t,o,e){t&&(this.rows=t),o&&(this.mineCount=o),e&&(this.blockSpace=e),this.isGameover=!1,this.isFirstClick=!0,this.blocks=m(this.rows,this.cols,this.mineCount),this.updateSize(),this.isSourceLoaded?this.drawUI():Promise.all(Object.keys(r).map((t=>s(r[t]).then((s=>{this.icons[t]=s}))))).then((()=>{this.isSourceLoaded=!0,this.drawUI(),this.addListeners()})).catch((t=>{alert(t.message)})),i(this.callbacks.onUpdate,this.getStateData(),0)}updateSize(){var t;const{blockSpace:s}=this,i=this.cvs.offsetWidth*this.pixRatio,o=(i-s)/this.cols-s,e=(null==(t=this.cvs.parentElement)?void 0:t.offsetHeight)*this.pixRatio;this.rows*(o+s)+s>e&&(this.rows=Math.floor(e/(o+s))),this.blockSize=o,this.cvs.width=i,this.cvs.height=this.rows*(o+s)+s}drawBlockBackground(t,s){const{blockSize:i,blockSpace:o}=this;this.ctx.drawImage(s,0,0,s.width,s.height,t.col*i+(t.col+1)*o,t.row*i+(t.row+1)*o,i,i)}drawBlockText(t){const s=t.num+"",{blockSize:i,blockSpace:o,ctx:e}=this,A=i/2+"px",c={1:"#ff0",2:"#0f0"}[s]||"#f00",n=e.measureText(s).width,a=t.col*(i+o)+o+(i-n)/2+this.pixRatio,l=t.row*(i+o)+o+(i-n)/2;e.save(),e.font=`bold ${A} serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=c,e.fillText(s,a,l),e.restore()}drawBlockIcon(t,s){const{blockSize:i,blockSpace:o}=this;let e,A;s.width>s.height?(e=i/2,A=e*(s.height/s.width)):(A=i/2,e=A*(s.width/s.height)),this.ctx.drawImage(s,t.col*(i+o)+o+(i-e)/2,t.row*(i+o)+o+(i-A)/2,e,A)}drawUI(){const{width:t,height:s}=this.cvs;this.ctx.clearRect(0,0,t,s),this.blocks.forEach((t=>{t.open?(this.drawBlockBackground(t,this.icons.iconBlockEnd),t.num>0&&(t.num<9?this.drawBlockText(t):this.drawBlockIcon(t,this.icons.iconBomb))):(this.drawBlockBackground(t,this.icons.iconBlockFront),t.flag&&this.drawBlockIcon(t,this.icons.iconFlag))}))}getCurBlock(t){const s=(t.offsetX||t.pageX)*this.pixRatio,i=(t.offsetY||t.pageY)*this.pixRatio,o=Math.floor(s/(this.blockSize+this.blockSpace)),e=Math.floor(i/(this.blockSize+this.blockSpace));return this.blocks.find((t=>t.row===e&&t.col===o))}swapBlockNum(t){const s=this.blocks.filter((t=>t.num<9)),i=s[o(0,s.length-1)],{num:e}=i;i.num=t.num,t.num=e}bombAndOver(){this.blocks.forEach((t=>{9===t.num&&(t.open=!0)})),this.isGameover=!0}openZeroBlocks(t){const s=(t,s)=>d(this.blocks,t,s);[s(t.row-1,t.col),s(t.row,t.col+1),s(t.row+1,t.col),s(t.row,t.col-1)].filter((t=>t)).forEach((t=>{(null==t?void 0:t.open)||(null==t?void 0:t.flag)||0!==(null==t?void 0:t.num)||(t.open=!0,this.openZeroBlocks(t))}))}isDone(){return this.blocks.filter((t=>t.num<9)).every((t=>t.open))}getStateData(){return this.blocks.reduce(((t,s)=>({opens:t.opens+(s.open?1:0),flags:t.flags+(s.flag?1:0)})),{opens:0,flags:0})}onClick(t){if(this.isGameover)return;const s=this.getCurBlock(t);!s||s.open||s.flag||(this.isFirstClick&&(this.isFirstClick=!1,9===s.num&&this.swapBlockNum(s)),s.open=!0,9===s.num?(this.bombAndOver(),i(this.callbacks.onOver)):0===s.num&&this.openZeroBlocks(s),i(this.callbacks.onUpdate,this.getStateData(),0),this.drawUI(),this.isDone()&&(this.isGameover=!0,i(this.callbacks.onWinning)))}onContextmenu(t){if(t.preventDefault(),this.isGameover)return;const s=this.getCurBlock(t);s&&!s.open&&(s.flag=!s.flag,this.drawUI(),i(this.callbacks.onUpdate,this.getStateData(),0))}}var k={data:()=>({game:null}),mounted(){const t=new g(this.$refs.ui,{onUpdate:t=>{console.log(t)},onOver:()=>{alert("很遗憾，挑战失败！"),t.start()},onWinning:()=>{alert("恭喜你！挑战成功"),t.start(t.cols+2,t.mineCount+2)}});t.start(),this.game=t},unmounted(){this.game&&(this.game.removeListeners(),this.game=null)}};const u=h();A("data-v-74998772");const w={class:"container"},v=l("div",{class:"dashboard"},[l("div",{class:"title"},"扫雷游戏")],-1),B={class:"game-ui"},p={ref:"ui"};c();const f=u(((t,s,i,o,e,A)=>(n(),a("div",w,[v,l("div",B,[l("canvas",p,null,512)])]))));k.render=f,k.__scopeId="data-v-74998772";export default k;
