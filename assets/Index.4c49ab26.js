import{a as t,g as s,d as e}from"./utils.3a965408.js";import{p as i,e as o,o as r,c as h,f as c,w as l}from"./vendor.eda28678.js";class a{constructor(t,s,e){this.row=t,this.col=s,this.type=e}draw(t,s,e,i){const o=s+i;t.save(),t.fillStyle="black"===this.type?"#000":"#fff",t.beginPath(),t.arc(this.col*o+o/2,this.row*o+o/2,e/2,0,2*Math.PI),t.fill(),t.restore()}}class n{constructor(t){this.game=t}getCurrent(t){const{cell:s}=this.game.grid.filter((s=>!t.some((t=>t.row===s.row&&t.col===s.col)))).reduce(((t,s)=>{const e=this.judge(s);return e>t.score?{score:e,cell:s}:t}),{score:0});return s&&new a(s.row,s.col,"white")}judge(t){const s="white",e="black";return this.LR(t,s)+this.TB(t,s)+this.RB(t,s)+this.RT(t,s)+100+(this.LR(t,e)+this.TB(t,e)+this.RB(t,e)+this.RT(t,e))}genChessList(t,s){const e=this.game.getChessList();return this.game.grid.map((i=>{const o=e.find((t=>t.col===i.col&&t.row===i.row));return new a(i.row,i.col,i.row===t.row&&i.col===t.col?s:null==o?void 0:o.type)}))}LR(t,s){let e=0,i=0,{row:o,col:r}=t,{rows:h}=this.game;const c=this.genChessList(t,s);for(let l=o;l>=0;l--){const t=c.find((t=>t.row===l&&t.col===r));if(!t||t.type!==s){(null==t?void 0:t.type)&&e++;break}i++}for(let l=o;l<h;l++){const t=c.find((t=>t.row===l&&t.col===r));if(!t||t.type!==s){(null==t?void 0:t.type)&&e++;break}i++}return this.model(--i,e)}TB(t,s){let e=0,i=0,{row:o,col:r}=t;const{cols:h}=this.game,c=this.genChessList(t,s);for(let l=r;l>=0;l--){let t=c.find((t=>t.col===l&&t.row===o));if(!t||t.type!==s){(null==t?void 0:t.type)&&e++;break}i++}for(let l=r;l<h;l++){let t=c.find((t=>t.col===l&&t.row===o));if(!t||t.type!==s){(null==t?void 0:t.type)&&e++;break}i++}return this.model(--i,e)}RB(t,s){let e=0,i=0;const{row:o,col:r}=t,{rows:h,cols:c}=this.game,l=this.genChessList(t,s);for(let a=o,n=r;a>=0&&n>=0;){let t=l.find((t=>t.row===a&&t.col===n));if(!t||t.type!==s){(null==t?void 0:t.type)&&e++;break}i++,a--,n--}for(let a=o,n=r;a<h&&n<c;){let t=l.find((t=>t.row===a&&t.col===n));if(!t||t.type!==s){(null==t?void 0:t.type)&&e++;break}i++,a++,n++}return this.model(--i,e)}RT(t,s){let e=0,i=0;const{row:o,col:r}=t,{rows:h,cols:c}=this.game,l=this.genChessList(t,s);for(let a=o,n=r;a>=0&&n<c;){let t=l.find((t=>t.row===a&&t.col===n));if(!t||t.type!==s){(null==t?void 0:t.type)&&e++;break}i++,a--,n++}for(let a=o,n=r;a<h&&n>=0;){let t=l.find((t=>t.row===a&&t.col===n));if(!t||t.type!==s){(null==t?void 0:t.type)&&e++;break}i++,a++,n--}return this.model(--i,e)}model(t,s){return 1===t&&1===s?1:2===t?0===s?1500:1===s?1:0:3===t?0===s?4e3:1===s?1500:0:4===t?0===s?1e4:1===s?4e3:0:5===t?1e5:0}}class d{constructor(t,s){this.cvs=t,this.callbacks=s,this.pixRatio=1,this.bSize=0,this.chessSize=0,this.rows=15,this.cols=15,this.isGameover=!1,this.chessList=[],this.grid=[],this.ctx=t.getContext("2d"),this.bSpace=this.pixRatio,this.aiPlayer=new n(this),this.addListeners()}start(){this.isGameover=!1,this.chessList=[],this.grid=this.genGrid(),this.updateSize(),this.drawUI()}getChessList(){return this.chessList}drawGrid(){const{ctx:s,cvs:e,bSize:i,bSpace:o,rows:r,cols:h}=this,c=i+o;s.save(),s.lineWidth=o,s.strokeStyle="#333",s.translate(c/2,c/2),s.beginPath(),t(r).forEach(((t,r)=>{s.moveTo(-o/2,c*r),s.lineTo(e.width-i-o/2,c*r),s.moveTo(c*r,-o/2),s.lineTo(c*r,e.width-i-o/2)})),s.stroke(),s.fillStyle="#000",[{row:3,col:3},{row:3,col:h-4},{row:r-4,col:3},{row:r-4,col:h-4}].forEach((t=>{s.beginPath(),s.arc(c*t.col,c*t.row,.1*i,0,2*Math.PI),s.fill()})),s.restore()}drawLastAiChess(t){const{bSize:s,bSpace:e,ctx:i}=this,o=s+e;i.save(),i.fillStyle="#ccc",i.beginPath(),i.arc(t.col*o+o/2,t.row*o+o/2,.35*this.chessSize,0,2*Math.PI),i.fill(),i.restore()}drawUI(){const{ctx:t,cvs:s}=this;t.clearRect(0,0,s.width,s.height),this.drawGrid(),this.chessList.forEach((s=>{s.draw(t,this.bSize,this.chessSize,this.bSpace)}))}updateSize(){this.pixRatio=s(this.ctx);const t=this.cvs.offsetWidth*this.pixRatio;this.bSize=(t-this.cols*this.bSpace)/this.cols,this.chessSize=.6*this.bSize,this.cvs.width=this.cvs.height=t}genGrid(){return t(this.rows).reduce(((s,e,i)=>[...s,...t(this.cols).map(((t,s)=>({row:i,col:s})))]),[])}getCurrent(t){const s=(t.offsetX||t.pageX)*this.pixRatio,e=(t.offsetY||t.pageY)*this.pixRatio,{bSize:i,bSpace:o}=this,r=i+o,h=Math.round((e-r/2)/r),c=Math.round((s-r/2)/r);if(this.chessList.some((t=>t.row===h&&t.col===c)))return;const l=c*r+r/2,n=h*r+r/2;return Math.pow(s-l,2)+Math.pow(e-n,2)<Math.pow(this.chessSize/2,2)?new a(h,c,"black"):void 0}checkResult(s){const e=t(9).map(((t,s)=>s-4)),i=t=>e.reduce(((e,i)=>{const o=this.chessList.find(t(i));return o?o.type===s.type?++e:0:e>4?e:0}),0)>4;return i((t=>e=>e.col===s.col&&e.row===s.row-t))||i((t=>e=>e.row===s.row&&e.col===s.col-t))||i((t=>e=>e.row===s.row+t&&e.col===s.col-t))||i((t=>e=>e.row===s.row+t&&e.col===s.col+t))}onClick(t){if(this.isGameover)return;const s=this.getCurrent(t);if(s){if(this.chessList.push(s),this.drawUI(),this.checkResult(s))return this.isGameover=!0,e(this.callbacks.onDone);const t=this.aiPlayer.getCurrent(this.chessList);if(t){if(this.chessList.push(t),this.drawUI(),this.drawLastAiChess(t),this.checkResult(t))return this.isGameover=!0,e(this.callbacks.onOver);if(this.chessList.length>=this.rows*this.cols)return this.isGameover=!0,e(this.callbacks.onDraw)}else this.isGameover=!0,e(this.callbacks.onDraw)}}onResize(){this.updateSize(),this.drawUI()}addListeners(){this.cvs.addEventListener("click",this.onClick.bind(this)),window.addEventListener("resize",this.onResize.bind(this))}removeListeners(){this.cvs.removeEventListener("click",this.onClick),window.removeEventListener("resize",this.onResize)}}var w={data:()=>({game:null}),mounted(){this.game=new d(this.$refs.canvas,{onDone:()=>{var t;alert("恭喜，你赢了！"),null==(t=this.game)||t.start()},onOver:()=>{alert("你输了！请点击[新游戏]，重新开始")},onDraw:()=>{var t;alert("平局！"),null==(t=this.game)||t.start()}}),this.game.start()},unmounted(){var t;null==(t=this.game)||t.removeListeners(),this.game=null},methods:{onStart(){var t;null==(t=this.game)||t.start()}}};const u=l();i("data-v-254a34b5");const f={class:"container"},v={class:"dashboard"},p=c("div",{class:"title"},"五子棋之人机大战",-1),g={class:"btns"},m={class:"game-ui"},b={ref:"canvas"};o();const L=u(((t,s,e,i,o,l)=>(r(),h("div",f,[c("div",v,[p,c("div",g,[c("button",{onClick:s[1]||(s[1]=(...t)=>l.onStart&&l.onStart(...t))},"新游戏")])]),c("div",m,[c("canvas",b,null,512)])]))));w.render=L,w.__scopeId="data-v-254a34b5";export default w;
